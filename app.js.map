{"version":3,"sources":["app/initialize.js","app/lib/editor.js","app/lib/getUrlVars.js","app/lib/map.js","app/lib/red_fetch.js","app/lib/taxonomy.js"],"names":["editor","require","document","addEventListener","console","log","initMap","getUrlVars","redFetch","taxonomy","map","endpoint","module","exports","urlVars","dataUrls","place","test","normalizedPlace","replace","length","createToiArray","toi_string","toi_array","split","i","trim","lang","typeOfInintiatives","toiHashtable","fillTOIs","data","toiSelect","getElementById","dataArray","results","bindings","lastTypeOfInitiative","forEach","entry","type_of_initiative_tag","value","label","itemLabel","currentObject","item","push","labelCompare","a","b","match","sort","newOption","createElement","optionValue","createAttribute","setAttributeNode","currentData","properties","type_of_initiative","tois","toi","newSelected","createTextNode","appendChild","getLangTaxURL","error","addFreeTagsRow","freetags","lastRow","lastChild","nodeType","previousSibling","keyNode","firstChild","nextSibling","newNr","parseInt","id","slice","newRow","divClass","newKey","newValue","keyId","valueId","elementName","cloneNode","fillForm","placeData","_deleted","style","display","key","field","valueNode","geometry","coordinates","lon","lat","undefined","my_current_marker","L","marker","icon","my_placeMarker","my_editableLayers","addLayer","my_drawControl","getDrawControl","addControl","panTo","LatLng","_id","e","createCORSRequest","method","url","xhr","XMLHttpRequest","open","XDomainRequest","clickSubmit","requiredFields","alert","parseFloat","allInputs","getElementsByTagName","freeTags","keys","values","element","type","name","nr","keynr","allSelects","childCounter","children","child","selected","allTextareas","uuid","sendData","JSON","stringify","setRequestHeader","send","onreadystatechange","readyState","status","retJson","parse","responseText","onclick","clickDelete","vars","parts","window","location","href","m","L_Hash","L_Draw","editableLayers","drawControl","placeMarker","allowNewMarker","markerValue","options","position","draw","polyline","polygon","rectangle","circle","edit","featureGroup","remove","Control","Draw","attrOsm","attrPois","leafletBgMaps","zoom","defaultlayer","center","baseMaps","tileLayer","attribution","maxZoom","noWrap","zoomControl","layers","ctrl","Layers","hash","Hash","FeatureGroup","Icon","extend","shadowUrl","iconAnchor","Point","iconSize","iconUrl","on","Event","CREATED","layerType","layer","bindPopup","_latlng","lng","toFixed","removeControl","updateMarkerFromForm","coords","latLng","setLatLng","onblur","processStatus","response","Promise","resolve","reject","Error","statusText","parseJson","json","getWrappedPromise","wrappedPromise","promise","then","bind","catch","getWrappedFetch","args","Array","prototype","call","arguments","fetch","apply","MAX_WAITING_TIME","getJSON","params","wrappedFetch","cacheBusting","Date","getTime","headers","timeoutId","setTimeout","clearTimeout","myGetJSON","successFunction","errorFunction","getJSONparams","redundantFetch","dataUrlArray","constructor","currentUrl","shift","localErrorFunction","localSuccessFunction","tax_query","encodeURIComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,SAASC,QAAQ,YAAR,CAAf;;AAEAC,SAASC,gBAAT,CAA0B,kBAA1B,EAA8C,YAAM;AAClD;AACAH;AACAI,UAAQC,GAAR,CAAY,iBAAZ;AACD,CAJD;;;;;;ACFA,IAAMC,UAAUL,QAAQ,UAAR,CAAhB;AACA,IAAMM,aAAaN,QAAQ,iBAAR,CAAnB;AACA,IAAMO,WAAWP,QAAQ,gBAAR,CAAjB;AACA,IAAMQ,WAAWR,QAAQ,eAAR,CAAjB;;AAEA,IAAIS,GAAJ;AACA,IAAMC,WAAW,oCAAjB;;AAEAC,OAAOC,OAAP,GAAiB,YAAY;AAC3BT,UAAQC,GAAR,CAAY,yBAAZ;;AAEAK,QAAMJ,SAAN;;AAEA,MAAIQ,UAAUP,YAAd;AACA,MAAIQ,QAAJ;AACA,MAAMC,QAAQF,QAAQ,OAAR,CAAd;AACA,MAAIE,KAAJ,EAAW;AACT,QAAI,sBAAsBC,IAAtB,CAA2BD,KAA3B,CAAJ,EAAuC;AACrC,UAAME,kBAAkBF,MAAMG,OAAN,CAAc,GAAd,EAAmB,EAAnB,CAAxB;AACA,UAAID,gBAAgBE,MAAhB,KAA2B,EAA/B,EAAmC;AACjCL,mBAAW,CAAEJ,WAAWK,KAAb,EAAoB,mCAAmCA,KAAvD,EAA8DA,KAA9D,CAAX;AACD,OAFD,MAEO;AACLD,mBAAW,CAAEC,KAAF,CAAX;AACD;AACF,KAPD,MAOO;AACLD,iBAAW,CAAEC,KAAF,CAAX;AACD;AACF;;AAED,WAASK,cAAT,CAAwBC,UAAxB,EAAoC;AAClC,QAAG,OAAOA,UAAP,KAAuB,QAA1B,EACE,OAAO,EAAP;AACF,QAAIC,YAAYD,WAAWE,KAAX,CAAiB,GAAjB,CAAhB;AACA,SAAI,IAAIC,IAAE,CAAV,EAAYA,IAAEF,UAAUH,MAAxB,EAA+BK,GAA/B,EAAmC;AACjCF,gBAAUE,CAAV,IAAeF,UAAUE,CAAV,EAAaC,IAAb,EAAf;AACD;AACD,WAAOH,SAAP;AACD;;AAED,MAAII,OAAO,IAAX;AACA,MAAIC,qBAAqB,EAAzB;AACA,MAAIC,eAAe,EAAnB;;AAEA,WAASC,QAAT,CAAkBC,IAAlB,EAAwB;AACtB,QAAIC,YAAY9B,SAAS+B,cAAT,CAAwB,yBAAxB,CAAhB;AACA,QAAIC,YAAYH,KAAKI,OAAL,CAAaC,QAA7B;AACA,QAAIC,uBAAuB,EAA3B;AACAH,cAAUI,OAAV,CAAkB,UAASC,KAAT,EAAgB;AAChC,UAAG,CAACA,MAAMC,sBAAV,EAAkC;AAChC;AACD;AACD,UAAGX,aAAaU,MAAMC,sBAAN,CAA6BC,KAA1C,CAAH,EAAqD;AAAE;AACrD;AACD;AACD,UAAIC,QAAQ,EAAZ;AACAA,YAAMH,MAAMI,SAAN,CAAgB,UAAhB,CAAN,IAAqCJ,MAAMI,SAAN,CAAgBF,KAArD;;AAEA,UAAIG,gBAAgB;AAClBC,cAAMN,MAAMM,IAAN,CAAWJ,KADC;AAElBC,eAAOA,KAFW;AAGlBF,gCAAwBD,MAAMC,sBAAN,CAA6BC;AAHnC,OAApB;AAKAb,yBAAmBkB,IAAnB,CAAwBF,aAAxB;AACAf,mBAAaU,MAAMC,sBAAN,CAA6BC,KAA1C,IAAmDG,aAAnD;AAED,KAlBD;AAmBA,aAASG,YAAT,CAAsBC,CAAtB,EAAwBC,CAAxB,EAA0B;AACxB;AACA,UAAGD,EAAEH,IAAF,IAAU,wCAAb,EAAuD,OAAO,CAAP;AACvD,UAAGI,EAAEJ,IAAF,IAAU,wCAAb,EAAuD,OAAO,CAAC,CAAR;;AAEvD;AACA,UAAGG,EAAER,sBAAF,IAA4BQ,EAAER,sBAAF,CAAyBU,KAAzB,CAA+B,SAA/B,CAA/B,EAA0E,OAAO,CAAP;AAC1E,UAAGD,EAAET,sBAAF,IAA4BS,EAAET,sBAAF,CAAyBU,KAAzB,CAA+B,SAA/B,CAA/B,EAA0E,OAAO,CAAC,CAAR;;AAE1E,UAAGF,EAAEN,KAAF,CAAQf,IAAR,IAAgBsB,EAAEP,KAAF,CAAQf,IAAR,CAAnB,EACE,OAAO,CAAC,CAAR,CADF,KAGE,OAAO,CAAP;AACH;AACDC,uBAAmBuB,IAAnB,CAAwBJ,YAAxB;;AAEAnB,uBAAmBU,OAAnB,CAA2B,UAASC,KAAT,EAAgB;AACzC,UAAIa,YAAYlD,SAASmD,aAAT,CAAuB,QAAvB,CAAhB;AACA,UAAIC,cAAcpD,SAASqD,eAAT,CAAyB,OAAzB,CAAlB;AACED,kBAAYb,KAAZ,GAAoBF,MAAMC,sBAA1B;AACFY,gBAAUI,gBAAV,CAA2BF,WAA3B;;AAEA,UAAGG,YAAYC,UAAZ,CAAuBC,kBAA1B,EAA8C;AAC5C,YAAIC,OAAOvC,eAAeoC,YAAYC,UAAZ,CAAuBC,kBAAtC,CAAX;AACAC,aAAKtB,OAAL,CAAa,UAASuB,GAAT,EAAc;AACzB,cAAGA,OAAOtB,MAAMC,sBAAhB,EAAwC;AACtC,gBAAIsB,cAAc5D,SAASqD,eAAT,CAAyB,UAAzB,CAAlB;AACAH,sBAAUI,gBAAV,CAA2BM,WAA3B;AACD;AACF,SALD;AAMD;;AAED,UAAIpB,QAAQxC,SAAS6D,cAAT,CAAwBxB,MAAMG,KAAN,CAAYf,IAAZ,CAAxB,CAAZ,CAhByC,CAgBe;AACxDyB,gBAAUY,WAAV,CAAsBtB,KAAtB;;AAEAV,gBAAUgC,WAAV,CAAsBZ,SAAtB;AACD,KApBD;AAsBD;;AAED;AACA5C,WAAU,CAAEC,SAASwD,aAAT,CAAuBtC,IAAvB,CAAF,EAAgC,wHAAsHA,IAAtH,GAA2H,OAA3J,CAAV,EACEG,QADF,EAEE,UAASoC,KAAT,EAAgB;AAAE9D,YAAQ8D,KAAR,CAAc,0CAAd;AAA2D,GAF/E;;AAIA,WAASC,cAAT,GAA0B;AACxB,QAAIC,WAAWlE,SAAS+B,cAAT,CAAwB,UAAxB,CAAf;;AAEA,QAAIoC,UAAUD,SAASE,SAAvB;AACA,WAAOD,QAAQE,QAAR,KAAqB,CAA5B,EAA+B;AAAE;AAC/BF,gBAAUA,QAAQG,eAAlB;AACD;;AAED,QAAIC,UAAWJ,QAAQK,UAAR,CAAmBH,QAAnB,KAAgC,CAAjC,GAAsCF,QAAQK,UAA9C,GAA2DL,QAAQK,UAAR,CAAmBC,WAA5F;AACA,QAAIC,QAAQC,SAASJ,QAAQK,EAAR,CAAWC,KAAX,CAAiB,CAAC,CAAlB,CAAT,IAAiC,CAA7C;;AAEA,QAAIC,SAAS9E,SAASmD,aAAT,CAAuB,KAAvB,CAAb;AACA,QAAI4B,WAAW/E,SAASqD,eAAT,CAAyB,OAAzB,CAAf;AACA0B,aAASxC,KAAT,GAAiB,KAAjB;AACAuC,WAAOxB,gBAAP,CAAwByB,QAAxB;AACA,QAAIC,SAAShF,SAASmD,aAAT,CAAuB,OAAvB,CAAb;AACA,QAAI8B,WAAWjF,SAASmD,aAAT,CAAuB,OAAvB,CAAf;AACA,QAAI+B,QAAQlF,SAASqD,eAAT,CAAyB,IAAzB,CAAZ;AACA6B,UAAM3C,KAAN,GAAc,QAAQmC,KAAtB;AACA,QAAIS,UAAUnF,SAASqD,eAAT,CAAyB,IAAzB,CAAd;AACA8B,YAAQ5C,KAAR,GAAgB,UAAUmC,KAA1B;AACAM,WAAO1B,gBAAP,CAAwB4B,KAAxB;AACAD,aAAS3B,gBAAT,CAA0B6B,OAA1B;;AAEA,QAAIC,cAAcpF,SAASqD,eAAT,CAAyB,MAAzB,CAAlB;AACA+B,gBAAY7C,KAAZ,GAAoB,UAApB;AACAyC,WAAO1B,gBAAP,CAAwB8B,WAAxB;AACAH,aAAS3B,gBAAT,CAA0B8B,YAAYC,SAAZ,CAAsB,IAAtB,CAA1B;;AAEAP,WAAOhB,WAAP,CAAmBkB,MAAnB;AACAF,WAAOhB,WAAP,CAAmBmB,QAAnB;AACAf,aAASJ,WAAT,CAAqBgB,MAArB;AACD;;AAED,MAAIvB,cAAc,EAAlB;;AAEA,WAAS+B,QAAT,CAAmBC,SAAnB,EAA8B;AAC5BhC,kBAAcgC,SAAd;;AAEA,QAAIhC,YAAYiC,QAAhB,EAA0B;AACxBxF,eAAS+B,cAAT,CAAwB,SAAxB,EAAmC0D,KAAnC,CAAyCC,OAAzC,GAAmD,OAAnD;AACD;;AAED,QAAInC,YAAYC,UAAhB,EAA4B;AAC1B,WAAK,IAAImC,GAAT,IAAgBpC,YAAYC,UAA5B,EAAwC;AACtC;AACA,YAAI,KAAKzC,IAAL,CAAU4E,GAAV,CAAJ,EAAoB;AAClB;AACD;;AAED,YAAIC,QAAQ5F,SAAS+B,cAAT,CAAwB,UAAU4D,GAAlC,CAAZ;AACA,YAAIpD,QAAQgB,YAAYC,UAAZ,CAAuBmC,GAAvB,CAAZ;;AAEA,YAAIC,KAAJ,EAAW;AACT;AACA;AACAA,gBAAMrD,KAAN,GAAcA,KAAd;AACD,SAJD,MAIO;AAAE;AACP;AACA,cAAI2B,WAAWlE,SAAS+B,cAAT,CAAwB,UAAxB,CAAf;AACA,cAAIoC,UAAUD,SAASE,SAAvB;AACA,iBAAOD,QAAQE,QAAR,KAAqB,CAA5B,EAA+B;AAAE;AAC/BF,sBAAUA,QAAQG,eAAlB;AACD;;AAED;AACA,cAAIC,UAAWJ,QAAQK,UAAR,CAAmBH,QAAnB,KAAgC,CAAjC,GAAsCF,QAAQK,UAA9C,GAA2DL,QAAQK,UAAR,CAAmBC,WAA5F;AACAF,kBAAQhC,KAAR,GAAgBoD,GAAhB;AACA,cAAIE,YAAa1B,QAAQC,SAAR,CAAkBC,QAAlB,KAA+B,CAAhC,GAAqCF,QAAQC,SAA7C,GAAyDD,QAAQC,SAAR,CAAkBE,eAA3F;AACAuB,oBAAUtD,KAAV,GAAkBA,KAAlB;;AAEA0B;AACD;AACF;AACF;AACD,QAAIV,YAAYuC,QAAZ,IAAwBvC,YAAYuC,QAAZ,CAAqBC,WAAjD,EAA8D;AAC5D,UAAIC,MAAMzC,YAAYuC,QAAZ,CAAqBC,WAArB,CAAiC,CAAjC,CAAV;AACA,UAAIE,MAAM1C,YAAYuC,QAAZ,CAAqBC,WAArB,CAAiC,CAAjC,CAAV;AACA,UAAIE,QAAQC,SAAR,IAAqBF,QAAQE,SAAjC,EAA4C;AAC1ChG,gBAAQ8D,KAAR,CAAc,kBAAd;AACA;AACD;;AAEDhE,eAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAAzC,GAAiDyD,GAAjD;AACAhG,eAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAAzC,GAAiD0D,GAAjD;;AAEAzF,UAAI2F,iBAAJ,GAAwB,IAAIC,EAAEC,MAAN,CAAa,CAACJ,GAAD,EAAMD,GAAN,CAAb,EAAyB,EAAEM,MAAM,IAAI9F,IAAI+F,cAAR,EAAR,EAAzB,CAAxB;AACA/F,UAAIgG,iBAAJ,CAAsBC,QAAtB,CAA+BjG,IAAI2F,iBAAnC;;AAEA3F,UAAIkG,cAAJ,GAAqBlG,IAAImG,cAAJ,CAAmB,KAAnB,CAArB;AACAnG,UAAIoG,UAAJ,CAAepG,IAAIkG,cAAnB;;AAEAlG,UAAIqG,KAAJ,CAAU,IAAIT,EAAEU,MAAN,CAAab,GAAb,EAAkBD,GAAlB,CAAV;AACD,KAlBD,MAkBO;AAAE;AACPxF,UAAIkG,cAAJ,GAAqBlG,IAAImG,cAAJ,CAAmB,IAAnB,CAArB;AACAnG,UAAIoG,UAAJ,CAAepG,IAAIkG,cAAnB;AACD;AACD,QAAGnD,YAAYC,UAAZ,CAAuBuD,GAA1B,EACE/G,SAAS+B,cAAT,CAAwB,KAAxB,EAA+BQ,KAA/B,GAAuCgB,YAAYC,UAAZ,CAAuBuD,GAA9D,CADF,KAEK,IAAGxD,YAAYwD,GAAf,EACH/G,SAAS+B,cAAT,CAAwB,KAAxB,EAA+BQ,KAA/B,GAAuCgB,YAAYwD,GAAnD;AACH;;AAED,MAAIjG,KAAJ,EAAW;AACTR,aAASO,QAAT,EAAmByE,QAAnB,EAA6B,UAAU0B,CAAV,EAAa;AACxC9G,cAAQ8D,KAAR,CAAcgD,CAAd;AACAxG,UAAIkG,cAAJ,GAAqBlG,IAAImG,cAAJ,CAAmB,IAAnB,CAArB;AACAnG,UAAIoG,UAAJ,CAAepG,IAAIkG,cAAnB;AACD,KAJD;AAKD,GAND,MAMO;AACLlG,QAAIkG,cAAJ,GAAqBlG,IAAImG,cAAJ,CAAmB,IAAnB,CAArB;AACAnG,QAAIoG,UAAJ,CAAepG,IAAIkG,cAAnB;AACD;;AAED,WAASO,iBAAT,CAA4BC,MAA5B,EAAoCC,GAApC,EAAyC;AACvC;AACA,QAAIC,MAAM,IAAIC,cAAJ,EAAV;AACA,QAAI,qBAAqBD,GAAzB,EAA8B;AAC5B;AACA;AACAA,UAAIE,IAAJ,CAASJ,MAAT,EAAiBC,GAAjB,EAAsB,IAAtB;AACD,KAJD,MAIO,IAAI,OAAOI,cAAP,KAA0B,WAA9B,EAA2C;AAChD;AACA;AACAH,YAAM,IAAIG,cAAJ,EAAN;AACAH,UAAIE,IAAJ,CAASJ,MAAT,EAAiBC,GAAjB;AACD,KALM,MAKA;AACL;AACAC,YAAM,IAAN;AACD;AACD,WAAOA,GAAP;AACD;;AAED,WAASI,WAAT,GAAuB;AACrBtH,YAAQC,GAAR,CAAY,mBAAZ;AACA,QAAMsH,iBAAiB,CAAE,yBAAF,EAA4B,WAA5B,EAAwC,eAAxC,EAAwD,eAAxD,CAAvB;AACA,SAAI,IAAIlG,IAAI,CAAZ,EAAeA,IAAIkG,eAAevG,MAAlC,EAA0CK,GAA1C,EAA+C;AAC7C,UAAIqD,KAAK6C,eAAelG,CAAf,CAAT;AACA,UAAIgB,QAAQvC,SAAS+B,cAAT,CAAwB6C,EAAxB,EAA4BrC,KAAxC;AACA,UAAG,CAAEA,KAAF,IAAW,CAACA,MAAMrB,MAArB,EAA6B;AAC3BhB,gBAAQ8D,KAAR,CAAc,mBAAmBY,EAAnB,GAAwB,QAAtC;AACA8C,cAAM,4BAA4B9C,GAAG3D,OAAH,CAAW,QAAX,EAAqB,EAArB,CAA5B,GAAuD,6BAA7D;AACA,eAAO,KAAP;AACD;AACF;;AAED,QAAIY,OAAO;AACT,cAAQ,SADC;AAET,oBAAc,EAFL;AAIT,kBAAY;AACV,gBAAQ,OADE;AAEV,uBAAe,CACb8F,WAAW3H,SAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAApD,CADa,EAEboF,WAAW3H,SAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAApD,CAFa;AAFL;AAJH,KAAX;;AAaA;AACA,QAAIqF,YAAY5H,SAAS6H,oBAAT,CAA8B,OAA9B,CAAhB;AACA,QAAIC,WAAW,EAAEC,MAAM,EAAR,EAAYC,QAAQ,EAApB,EAAf;;AAEA9H,YAAQC,GAAR,CAAYyH,SAAZ;;AAEA,SAAK,IAAIrG,IAAI,CAAb,EAAgBA,IAAIqG,UAAU1G,MAA9B,EAAsCK,GAAtC,EAA2C;AACzC,UAAI0G,UAAUL,UAAUrG,CAAV,CAAd;AACA,UAAI,CAAC0G,QAAQC,IAAT,KAAkB,MAAtB,EAA8B;AAC5B;AACD;AACD,UAAID,QAAQ1F,KAAR,IAAiB0F,QAAQrD,EAA7B,EAAiC;AAC/B1E,gBAAQC,GAAR,CAAY8H,QAAQrD,EAAR,GAAa,IAAb,GAAoBqD,QAAQ1F,KAAxC;AACA,YAAI,SAASxB,IAAT,CAAckH,QAAQrD,EAAtB,CAAJ,EAA+B;AAC7B,cAAIe,MAAMsC,QAAQrD,EAAR,CAAW3D,OAAX,CAAmB,QAAnB,EAA6B,EAA7B,CAAV;AACAY,eAAK2B,UAAL,CAAgBmC,GAAhB,IAAuBsC,QAAQ1F,KAAR,CAAcf,IAAd,EAAvB;AACH;AACE,SAJD,MAIO,IAAI,cAAcT,IAAd,CAAmBkH,QAAQrD,EAA3B,KAAkCqD,QAAQE,IAAR,KAAiB,UAAvD,EAAmE;AACxE,cAAIC,KAAKH,QAAQrD,EAAR,CAAW3D,OAAX,CAAmB,MAAnB,EAA2B,EAA3B,CAAT;AACA6G,mBAASC,IAAT,CAAcK,EAAd,IAAoBH,QAAQ1F,KAA5B;AACD,SAHM,MAGA,IAAI,gBAAgBxB,IAAhB,CAAqBkH,QAAQrD,EAA7B,KAAoCqD,QAAQE,IAAR,KAAiB,UAAzD,EAAqE;AAC1E,cAAIC,KAAKH,QAAQrD,EAAR,CAAW3D,OAAX,CAAmB,QAAnB,EAA6B,EAA7B,CAAT;AACA6G,mBAASE,MAAT,CAAgBI,EAAhB,IAAsBH,QAAQ1F,KAA9B;AACD;AACF;AACF;AACDrC,YAAQC,GAAR,CAAY2H,QAAZ;;AAEA,SAAK,IAAIO,KAAT,IAAkBP,SAASC,IAA3B,EAAiC;AAC/B,UAAIpC,MAAMmC,SAASC,IAAT,CAAcM,KAAd,EAAqB7G,IAArB,EAAV;AACA,UAAImE,OAAOmC,SAASE,MAAT,CAAgBK,KAAhB,CAAX,EAAmC;AAAE;AACnCxG,aAAK2B,UAAL,CAAgBmC,GAAhB,IAAuBmC,SAASE,MAAT,CAAgBK,KAAhB,EAAuB7G,IAAvB,EAAvB;AACD;AACF;;AAED;AACA,QAAI8G,aAAatI,SAAS6H,oBAAT,CAA8B,QAA9B,CAAjB;AACA,SAAK,IAAItG,IAAI,CAAb,EAAgBA,IAAI+G,WAAWpH,MAA/B,EAAuCK,GAAvC,EAA4C;AAC1C,UAAI0G,UAAUK,WAAW/G,CAAX,CAAd;AACA,UAAI,SAASR,IAAT,CAAckH,QAAQrD,EAAtB,KAA6BqD,QAAQ1F,KAAzC,EAAgD;AAC9C,YAAIoD,MAAMsC,QAAQrD,EAAR,CAAW3D,OAAX,CAAmB,QAAnB,EAA6B,EAA7B,CAAV;;AAEA,aAAI,IAAIsH,eAAe,CAAvB,EAA0BA,eAAeN,QAAQO,QAAR,CAAiBtH,MAA1D,EAAkEqH,cAAlE,EAAkF;AAChF,cAAIE,QAAQR,QAAQO,QAAR,CAAiBD,YAAjB,CAAZ;AACA,cAAGE,MAAMC,QAAN,IAAkB,IAArB,EAA2B;AACzB7G,iBAAK2B,UAAL,CAAgBmC,GAAhB,IAAuB,CAAC9D,KAAK2B,UAAL,CAAgBmC,GAAhB,IAAwB9D,KAAK2B,UAAL,CAAgBmC,GAAhB,IAAuB,GAA/C,GAAsD,EAAvD,IAA6D8C,MAAMlG,KAA1F;AACD;AACF;AACF;AACF;;AAED;AACA,QAAIoG,eAAe3I,SAAS6H,oBAAT,CAA8B,UAA9B,CAAnB;AACA,SAAK,IAAItG,IAAI,CAAb,EAAgBA,IAAIoH,aAAazH,MAAjC,EAAyCK,GAAzC,EAA8C;AAC5C,UAAI0G,UAAUU,aAAapH,CAAb,CAAd;AACA,UAAI,SAASR,IAAT,CAAckH,QAAQrD,EAAtB,KAA6BqD,QAAQ1F,KAAzC,EAAgD;AAC9C,YAAIoD,MAAMsC,QAAQrD,EAAR,CAAW3D,OAAX,CAAmB,QAAnB,EAA6B,EAA7B,CAAV;AACAY,aAAK2B,UAAL,CAAgBmC,GAAhB,IAAuBsC,QAAQ1F,KAAR,CAAcf,IAAd,EAAvB;AACD;AACF;;AAEDtB,YAAQC,GAAR,CAAY0B,IAAZ;;AAEA,QAAM+G,OAAO5I,SAAS+B,cAAT,CAAwB,KAAxB,EAA+BQ,KAA5C;AACA,QAAMsG,WAAWC,KAAKC,SAAL,CAAelH,IAAf,CAAjB;AACA3B,YAAQC,GAAR,CAAY0I,QAAZ;;AAEA;AACA,QAAIzB,MAAMH,kBAAkB2B,OAAO,KAAP,GAAe,MAAjC,EAAyCnI,WAAWmI,IAApD,CAAV;AACAxB,QAAI4B,gBAAJ,CAAqB,cAArB,EAAqC,kBAArC;AACA5B,QAAI6B,IAAJ,CAASJ,QAAT;AACA3I,YAAQC,GAAR,CAAYiH,GAAZ;;AAEAA,QAAI8B,kBAAJ,GAAyB,YAAY;AACnC,UAAI9B,IAAI+B,UAAJ,IAAkB,CAAtB,EAAyB;AACvB,YAAI/B,IAAIgC,MAAJ,IAAc,GAAlB,EAAuB;AACrB,cAAIC,UAAUP,KAAKQ,KAAL,CAAWlC,IAAImC,YAAf,CAAd;AACArJ,kBAAQC,GAAR,CAAYkJ,OAAZ;AACArJ,mBAAS+B,cAAT,CAAwB,KAAxB,EAA+BQ,KAA/B,GAAuC8G,QAAQzE,EAA/C;AACD,SAJD,MAIO;AACL1E,kBAAQ8D,KAAR,CAAcoD,GAAd;AACD;AACF;AACF,KAVD;AAWApH,aAAS+B,cAAT,CAAwB,SAAxB,EAAmC0D,KAAnC,CAAyCC,OAAzC,GAAmD,MAAnD;AACD;AACD1F,WAAS+B,cAAT,CAAwB,MAAxB,EAAgCyH,OAAhC,GAA0ChC,WAA1C;;AAEA,WAASiC,WAAT,GAAuB;AACrB,QAAMb,OAAO5I,SAAS+B,cAAT,CAAwB,KAAxB,EAA+BQ,KAA5C;AACA,QAAI,CAACqG,IAAL,EAAW;AACTlB,YAAM,mBAAN;AACA;AACD;AACD,QAAIN,MAAMH,kBAAkB,QAAlB,EAA4BxG,WAAWmI,IAAvC,CAAV;AACAxB,QAAI6B,IAAJ;AACA/I,YAAQC,GAAR,CAAYiH,GAAZ;;AAEAA,QAAI8B,kBAAJ,GAAyB,YAAY;AACnC,UAAI9B,IAAI+B,UAAJ,IAAkB,CAAtB,EAAyB;AACvB,YAAI/B,IAAIgC,MAAJ,IAAc,GAAlB,EAAuB;AACrB,cAAIC,UAAUP,KAAKQ,KAAL,CAAWlC,IAAImC,YAAf,CAAd;AACArJ,kBAAQC,GAAR,CAAYkJ,OAAZ;AACD,SAHD,MAGO;AACLnJ,kBAAQ8D,KAAR,CAAcoD,GAAd;AACD;AACF;AACF,KATD;AAUApH,aAAS+B,cAAT,CAAwB,SAAxB,EAAmC0D,KAAnC,CAAyCC,OAAzC,GAAmD,OAAnD;AACD;AACD1F,WAAS+B,cAAT,CAAwB,QAAxB,EAAkCyH,OAAlC,GAA4CC,WAA5C;AACAzJ,WAAS+B,cAAT,CAAwB,MAAxB,EAAgCyH,OAAhC,GAA0CvF,cAA1C;;AAEA/D,UAAQC,GAAR,CAAY,uBAAZ;AACD,CAxXD;;;;;;ACRA;;;;;;;;;;;;;;AAcA,SAASE,UAAT,GAAuB;AACrB,MAAIqJ,OAAO,EAAX;AACA,MAAIC,QAAQC,OAAOC,QAAP,CAAgBC,IAAhB,CAAqB7I,OAArB,CAA6B,yBAA7B,EAAwD,UAAU8I,CAAV,EAAapE,GAAb,EAAkBpD,KAAlB,EAAyB;AAC3FmH,SAAK/D,GAAL,IAAYpD,MAAMtB,OAAN,CAAc,MAAd,EAAsB,EAAtB,CAAZ;AACD,GAFW,CAAZ;AAGA,SAAOyI,IAAP;AACD;;AAEDhJ,OAAOC,OAAP,GAAiBN,UAAjB;;;;;;ACtBA,IAAM+F,IAAIrG,QAAQ,SAAR,CAAV;AACA,IAAMiK,SAASjK,QAAQ,cAAR,CAAf;AACA,IAAMkK,SAASlK,QAAQ,cAAR,CAAf;AACA,IAAMM,aAAaN,QAAQ,iBAAR,CAAnB;;AAEA,IAAImK,cAAJ;AACA,IAAIC,WAAJ;AACA,IAAIC,WAAJ;;AAEA,SAASzD,cAAT,CAAyB0D,cAAzB,EAAyC;AACvC,MAAIC,cAAcD,iBAAiB,EAAE/D,MAAM,IAAI8D,WAAJ,EAAR,EAAjB,GAA+C,KAAjE;AACA,MAAIG,UAAU;AACZC,cAAU,YADE;AAEZC,UAAM;AACJC,gBAAU,KADN;AAEJC,eAAS,KAFL;AAGJC,iBAAW,KAHP;AAIJC,cAAQ,KAJJ;AAKJxE,cAAQiE;AALJ,KAFM;AASZQ,UAAM;AACJC,oBAAcb,cADV,EAC0B;AAC9Bc,cAAQ;AAFJ;AATM,GAAd;AAcA,SAAO,IAAI5E,EAAE6E,OAAF,CAAUC,IAAd,CAAmBX,OAAnB,CAAP;AACD;;AAED,SAASnK,OAAT,GAAoB;AAClBF,UAAQC,GAAR,CAAY,eAAZ;AACA,MAAIK,GAAJ;;AAEA,MAAI2K,UAAU,oJAAd;AACA,MAAIC,WAAW,gIAAf;AACA,MAAIC,aAAJ;AACA,MAAIC,IAAJ;AACA,MAAIC,YAAJ;AACA,MAAIC,MAAJ;AACA,MAAIC,WAAW,EAAf;;AAEAA,WAAS,QAAT,IAAqB,IAAIrF,EAAEsF,SAAN,CAAgB,oDAAhB,EAAsE;AACzFC,iBAAaR,UAAUC,QADkE;AAEzFQ,aAAS,EAFgF;AAGzFC,YAAQ;AAHiF,GAAtE,CAArB;AAKAJ,WAAS,gBAAT,IAA6B,IAAIrF,EAAEsF,SAAN,CAAgB,mEAAhB,EAAqF;AAChHC,iBAAa,kEACT,6EADS,GAETR,OAFS,GAECC,QAHkG;AAIhHQ,aAAS,EAJuG;AAKhHC,YAAQ;AALwG,GAArF,CAA7B;AAOAJ,WAAS,mBAAT,IAAgC,IAAIrF,EAAEsF,SAAN,CAAgB,8EAAhB,EAAgG;AAC9HC,iBAAa,kEACT,6EADS,GAETR,OAFS,GAECC,QAHgH;AAI9HQ,aAAS,EAJqH;AAK9HC,YAAQ;AALsH,GAAhG,CAAhC;AAOAJ,WAAS,KAAT,IAAkB,IAAIrF,EAAEsF,SAAN,CAAgB,sDAAhB,EAAwE;AACxFC,iBAAa,oGACTR,OADS,GACCC,QAF0E;AAGxFQ,aAAS,EAH+E;AAIxFC,YAAQ;AAJgF,GAAxE,CAAlB;;AAOA,MAAI,CAACR,aAAL,EAAoB;AAClBA,oBAAgB;AACd,0BAAoBI,SAAS,gBAAT,CADN;AAEd,qCAA+BA,SAAS,mBAAT,CAFjB;AAGd,gCAA0BA,SAAS,QAAT,CAHZ;AAId,qCAA+BA,SAAS,KAAT;AAJjB,KAAhB;AAMD;AACD,MAAI,CAACF,YAAL,EAAmB;AACjBA,mBAAeE,SAAS,QAAT,CAAf;AACD;;AAEDjL,QAAM4F,EAAE5F,GAAF,CAAM,KAAN,EAAa;AACjBsL,iBAAa,IADI;AAEjBN,YAAQA,SAASA,MAAT,GAAkB,IAAIpF,EAAEU,MAAN,CAAa,OAAb,EAAsB,OAAtB,CAFT;AAGjBwE,UAAMA,OAAOA,IAAP,GAAc,EAHH;AAIjBS,YAAQR;AAJS,GAAb,CAAN;;AAOA,MAAMS,OAAO,IAAI5F,EAAE6E,OAAF,CAAUgB,MAAd,CAAqBZ,aAArB,CAAb;AACA7K,MAAIoG,UAAJ,CAAeoF,IAAf;AACA,MAAIE,OAAO,IAAI9F,EAAE+F,IAAN,CAAW3L,GAAX,CAAX,CA3DkB,CA2DS;;AAE3B;AACA0J,mBAAiB,IAAI9D,EAAEgG,YAAN,EAAjB;AACA5L,MAAIiG,QAAJ,CAAayD,cAAb;AACAE,gBAAchE,EAAEiG,IAAF,CAAOC,MAAP,CAAc;AAC1B/B,aAAS;AACPgC,iBAAW,IADJ;AAEPC,kBAAY,IAAIpG,EAAEqG,KAAN,CAAY,EAAZ,EAAgB,EAAhB,CAFL;AAGPC,gBAAU,IAAItG,EAAEqG,KAAN,CAAY,EAAZ,EAAgB,EAAhB,CAHH;AAIPE,eAAS;AAJF;AADiB,GAAd,CAAd;;AASAnM,MAAIoM,EAAJ,CAAOxG,EAAE8E,IAAF,CAAO2B,KAAP,CAAaC,OAApB,EAA6B,UAAU9F,CAAV,EAAa;AACxC,QAAIkB,OAAOlB,EAAE+F,SAAb;AACA,QAAIC,QAAQhG,EAAEgG,KAAd;;AAEA,QAAI9E,SAAS,QAAb,EAAuB;AACrB8E,YAAMC,SAAN,CAAgB,UAAhB;AACD;;AAED/C,mBAAezD,QAAf,CAAwBuG,KAAxB;AACAxM,QAAI2F,iBAAJ,GAAwB6G,KAAxB;AACAhN,aAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAAzC,GAAiDyK,MAAME,OAAN,CAAcC,GAAd,CAAkBC,OAAlB,CAA0B,CAA1B,CAAjD;AACApN,aAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAAzC,GAAiDyK,MAAME,OAAN,CAAcjH,GAAd,CAAkBmH,OAAlB,CAA0B,CAA1B,CAAjD;;AAEA5M,QAAI6M,aAAJ,CAAkB7M,IAAIkG,cAAtB;AACAlG,QAAIkG,cAAJ,GAAqBC,eAAe,KAAf,CAArB,CAdwC,CAcG;AAC3CnG,QAAIoG,UAAJ,CAAepG,IAAIkG,cAAnB;AACE;AACH,GAjBD;;AAmBAlG,MAAIoM,EAAJ,CAAO,eAAP,EAAwB,UAAU5F,CAAV,EAAa;AACnC9G,YAAQC,GAAR,CAAY,UAAZ;AACAD,YAAQC,GAAR,CAAY6G,CAAZ;AACAhH,aAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAAzC,GAAiDyE,EAAEgG,KAAF,CAAQE,OAAR,CAAgBC,GAAhB,CAAoBC,OAApB,CAA4B,CAA5B,CAAjD;AACApN,aAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAAzC,GAAiDyE,EAAEgG,KAAF,CAAQE,OAAR,CAAgBjH,GAAhB,CAAoBmH,OAApB,CAA4B,CAA5B,CAAjD;AACD,GALD;;AAOA5M,MAAIgG,iBAAJ,GAAwB0D,cAAxB;AACA1J,MAAIkG,cAAJ,GAAqByD,WAArB;AACA3J,MAAI+F,cAAJ,GAAqB6D,WAArB;AACA5J,MAAImG,cAAJ,GAAqBA,cAArB;;AAEAnG,MAAI8M,oBAAJ,GAA2B,YAAY;AACrC,QAAMrH,MAAMjG,SAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAArD;AACA,QAAMyD,MAAMhG,SAAS+B,cAAT,CAAwB,eAAxB,EAAyCQ,KAArD;AACArC,YAAQC,GAAR,CAAY,cAAc8F,GAAd,GAAoB,QAApB,GAA+BD,GAA3C;;AAEA,QAAIC,OAAOD,GAAX,EAAgB;AACd,UAAMuH,SAASnH,EAAEoH,MAAF,CAASvH,GAAT,EAAcD,GAAd,CAAf;AACAxF,UAAI2F,iBAAJ,CAAsBsH,SAAtB,CAAgCF,MAAhC;AACA/M,UAAIqG,KAAJ,CAAU0G,MAAV;AACD;AACF,GAVD;AAWAvN,WAAS+B,cAAT,CAAwB,eAAxB,EAAyC2L,MAAzC,GAAkDlN,IAAI8M,oBAAtD;AACAtN,WAAS+B,cAAT,CAAwB,eAAxB,EAAyC2L,MAAzC,GAAkDlN,IAAI8M,oBAAtD;;AAEA;;AAEApN,UAAQC,GAAR,CAAY,aAAZ;AACA,SAAOK,GAAP;AACD;;AAEDE,OAAOC,OAAP,GAAiBP,OAAjB;;;;;;ACxJA;;;;;;;;;;;AAWA;;;;;;AAMA;;;;;AAKA,IAAIuN,gBAAgB,SAAhBA,aAAgB,CAAUC,QAAV,EAAoB;AACpC;AACF,MAAIA,SAASxE,MAAT,KAAoB,GAApB,IAA2BwE,SAASxE,MAAT,KAAoB,CAAnD,EAAsD;AACpD,WAAOyE,QAAQC,OAAR,CAAgBF,QAAhB,CAAP;AACD,GAFD,MAEO;AACL,WAAOC,QAAQE,MAAR,CAAe,IAAIC,KAAJ,CAAUJ,SAASK,UAAnB,CAAf,CAAP;AACD;AACF,CAPD;;AASA,IAAIC,YAAY,SAAZA,SAAY,CAAUN,QAAV,EAAoB;AAClC,SAAOA,SAASO,IAAT,EAAP;AACD,CAFD;;AAIA;AACA;AACA,IAAIC,oBAAoB,SAApBA,iBAAoB,GAAY;AAClC,MAAIC,iBAAiB,EAArB;AACA,MAAIC,UAAU,IAAIT,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AACnDM,mBAAeP,OAAf,GAAyBA,OAAzB;AACAO,mBAAeN,MAAf,GAAwBA,MAAxB;AACD,GAHa,CAAd;AAIAM,iBAAeE,IAAf,GAAsBD,QAAQC,IAAR,CAAaC,IAAb,CAAkBF,OAAlB,CAAtB;AACAD,iBAAeI,KAAf,GAAuBH,QAAQG,KAAR,CAAcD,IAAd,CAAmBF,OAAnB,CAAvB;AACAD,iBAAeC,OAAf,GAAyBA,OAAzB,CARkC,CAQF;AAChC,SAAOD,cAAP;AACD,CAVD;;AAYA;AACA,IAAIK,kBAAkB,SAAlBA,eAAkB,GAAY;AAChC,MAAIL,iBAAiBD,mBAArB;AACA,MAAIO,OAAOC,MAAMC,SAAN,CAAgBhK,KAAhB,CAAsBiK,IAAtB,CAA2BC,SAA3B,CAAX,CAFgC,CAEgB;;AAEhDnF,SAAOoF,KAAP,CAAaC,KAAb,CAAmB,IAAnB,EAAyBN,IAAzB,EAA8B;AAA9B,GACOJ,IADP,CACY,UAAUX,QAAV,EAAoB;AACxBS,mBAAeP,OAAf,CAAuBF,QAAvB;AACD,GAHP,EAGS,UAAU5J,KAAV,EAAiB;AAClBqK,mBAAeN,MAAf,CAAsB/J,KAAtB;AACD,GALP,EAMOyK,KANP,CAMa,UAAUzK,KAAV,EAAiB;AACtBqK,mBAAeI,KAAf,CAAqBzK,KAArB;AACD,GARP;AASA,SAAOqK,cAAP;AACD,CAdD;;AAgBA;;;;;;;EAOE,IAAIa,mBAAmB,IAAvB,C,CAA2B;;AAE7B,IAAIC,UAAU,SAAVA,OAAU,CAAUC,MAAV,EAAkB;AAC9B,MAAIC,eAAeX,gBACbU,OAAOE,YAAP,GAAsBF,OAAOjI,GAAP,GAAa,GAAb,GAAmB,IAAIoI,IAAJ,GAAWC,OAAX,EAAzC,GAAgEJ,OAAOjI,GAD1D,EAEjB;AACED,YAAQ,KADV,EACiB;AACfuI,aAAS;AACP,gBAAU;AADH;AAFX,GAFiB,CAAnB;;AASA,MAAIC,YAAYC,WAAW,YAAY;AACrCN,iBAAatB,MAAb,CAAoB,IAAIC,KAAJ,CAAU,gCAAgCoB,OAAOjI,GAAjD,CAApB,EADqC,CACqC;AAC3E,GAFe,EAEb+H,gBAFa,CAAhB;;AAIA,SAAOG,aAAaf,OAAb,CAAoB;AAApB,GACAC,IADA,CACK,UAAUX,QAAV,EAAoB;AACxBgC,iBAAaF,SAAb;AACA,WAAO9B,QAAP;AACD,GAJA,EAKAW,IALA,CAKKZ,aALL,EAMAY,IANA,CAMKL,SANL,CAAP;AAOD,CArBD;;AAuBA,SAAS2B,SAAT,CAAoB1I,GAApB,EAAyB2I,eAAzB,EAA0CC,aAA1C,EAAyD;AACvD,MAAIC,gBAAgB,EAAE7I,KAAKA,GAAP,EAAYmI,cAAc,IAA1B,EAApB;;AAEAH,UAAQa,aAAR,EAAuBzB,IAAvB,CACE,UAAU1M,IAAV,EAAgB;AAAEiO,oBAAgBjO,IAAhB;AAAuB,GAD3C,EAEE,UAAUmC,KAAV,EAAiB;AAAE+L,kBAAc/L,KAAd;AAAsB,GAF3C;AAID;;AAED,SAASiM,cAAT,CAAyBC,YAAzB,EAAuCJ,eAAvC,EAAwDC,aAAxD,EAAuE;AACrE,MAAI,EAAE,CAAC,CAACG,YAAF,IAAkBtB,UAAUsB,aAAaC,WAA3C,CAAJ,EAA6D;AAC3DjQ,YAAQ8D,KAAR,CAAc,sCAAd;AACA9D,YAAQ8D,KAAR,CAAckM,YAAd;AACA,WAAO,KAAP;AACD;AACD,MAAIE,aAAaF,aAAa,CAAb,CAAjB;AACA,MAAI,OAAQE,UAAR,KAAwB,QAA5B,EAAsC;AACpClQ,YAAQ8D,KAAR,CAAc,kCAAd;AACA,WAAO,KAAP;AACD;;AAED9D,UAAQC,GAAR,CAAY,8BAAZ;AACAD,UAAQC,GAAR,CAAY+P,YAAZ;;AAEAA,eAAaG,KAAb;;AAEA,MAAIC,kBAAJ;AACA,MAAIC,oBAAJ;AACA,MAAIL,aAAahP,MAAb,IAAuB,CAA3B,EAA8B;AAAE;AAC9BqP,2BAAuBT,eAAvB;AACAQ,yBAAqBP,aAArB;AACD,GAHD,MAGO;AACLQ,2BAAuBT,eAAvB;AACAQ,yBAAqB,4BAAUtM,KAAV,EAAiB;AACpCiM,qBAAeC,YAAf,EAA6BJ,eAA7B,EAA8CC,aAA9C;AACD,KAFD;AAGD;;AAED,MAAIC,gBAAgB,EAAE7I,KAAKiJ,UAAP,EAAmBd,cAAc,IAAjC,EAApB;AACAH,UAAQa,aAAR,EAAuBzB,IAAvB,CACE,UAAU1M,IAAV,EAAgB;AAAE0O,yBAAqB1O,IAArB,EAA4B3B,QAAQC,GAAR,CAAY,qBAAZ,EAAoCD,QAAQC,GAAR,CAAY0B,IAAZ;AAAmB,GADvG,EAEE,UAAUmC,KAAV,EAAiB;AAAEsM,uBAAmBtM,KAAnB,EAA2B9D,QAAQC,GAAR,CAAY,kBAAZ,EAAiCD,QAAQC,GAAR,CAAY6D,KAAZ;AAAoB,GAFrG;AAID;;AAEDtD,OAAOC,OAAP,GAAiBsP,cAAjB;;;;;;AC/IA;;;;;;;;;;;;AAaA,SAASlM,aAAT,CAAuBtC,IAAvB,EAA6B;AAC3B,MAAG,CAACA,IAAJ,EAAU;AACRvB,YAAQ8D,KAAR,CAAc,8BAAd;AACA,WAAO,KAAP;AACD;;AAED,MAAIwM,YACF,8CACA,gDADA,GAEA,uDAFA,GAGA,iDAHA,GAIA,oGAJA,GAKA,SALA,GAME,uBANF,GAOE,6BAPF,GAQE,0CARF,GASE,oDATF,GAUE,gFAVF,GAUmF/O,IAVnF,GAUwF,MAVxF,GAWE,+EAXF,GAYE,6DAZF,GAYgEA,IAZhE,GAYqE,KAZrE,GAaA,GAdF;;AAgBC,SAAO,kFAAiFgP,mBAAmBD,SAAnB,CAAjF,GAAiH,cAAxH;AACF;;AAED9P,OAAOC,OAAP,GAAiB;AACfoD,iBAAeA;AADA,CAAjB","file":"public/app.js","sourcesContent":["const editor = require('lib/editor')\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  // do your setup here\n  editor()\n  console.log('Initialized app')\n})\n","const initMap = require('./map.js')\nconst getUrlVars = require('./getUrlVars.js')\nconst redFetch = require('./red_fetch.js')\nconst taxonomy = require('./taxonomy.js')\n\nvar map\nconst endpoint = 'https://data.transformap.co/place/'\n\nmodule.exports = function () {\n  console.log('editor initialize start')\n\n  map = initMap()\n\n  var urlVars = getUrlVars()\n  var dataUrls\n  const place = urlVars['place']\n  if (place) {\n    if (/^[0-9a-f-]{32,36}$/i.test(place)) {\n      const normalizedPlace = place.replace(/-/, '')\n      if (normalizedPlace.length === 32) {\n        dataUrls = [ endpoint + place, 'http://192.168.0.2:6000/place/' + place, place ]\n      } else {\n        dataUrls = [ place ]\n      }\n    } else {\n      dataUrls = [ place ]\n    }\n  }\n\n  function createToiArray(toi_string) {\n    if(typeof(toi_string) !== 'string')\n      return [];\n    var toi_array = toi_string.split(';');\n    for(var i=0;i<toi_array.length;i++){\n      toi_array[i] = toi_array[i].trim();\n    }\n    return toi_array;\n  }\n\n  var lang = 'en'\n  var typeOfInintiatives = []\n  var toiHashtable = {}\n\n  function fillTOIs(data) {\n    var toiSelect = document.getElementById('_key_type_of_initiative')\n    var dataArray = data.results.bindings\n    var lastTypeOfInitiative = ''\n    dataArray.forEach(function(entry) {\n      if(!entry.type_of_initiative_tag) {\n        return\n      }\n      if(toiHashtable[entry.type_of_initiative_tag.value]) { // filter out duplicates\n        return\n      }\n      var label = {}\n      label[entry.itemLabel['xml:lang']] = entry.itemLabel.value\n\n      var currentObject = {\n        item: entry.item.value,\n        label: label,\n        type_of_initiative_tag: entry.type_of_initiative_tag.value\n      }\n      typeOfInintiatives.push(currentObject)\n      toiHashtable[entry.type_of_initiative_tag.value] = currentObject\n\n    })\n    function labelCompare(a,b){\n      // 'Others' cat should get sorted last\n      if(a.item == \"https://base.transformap.co/entity/Q20\") return 1;\n      if(b.item == \"https://base.transformap.co/entity/Q20\") return -1;\n\n      //in toi list, 'other*' should be last\n      if(a.type_of_initiative_tag && a.type_of_initiative_tag.match(/^other_/)) return 1;\n      if(b.type_of_initiative_tag && b.type_of_initiative_tag.match(/^other_/)) return -1;\n\n      if(a.label[lang] < b.label[lang])\n        return -1\n      else\n        return 1\n    }\n    typeOfInintiatives.sort(labelCompare)\n\n    typeOfInintiatives.forEach(function(entry) {\n      var newOption = document.createElement('option')\n      var optionValue = document.createAttribute('value')\n        optionValue.value = entry.type_of_initiative_tag\n      newOption.setAttributeNode(optionValue)\n\n      if(currentData.properties.type_of_initiative) {\n        var tois = createToiArray(currentData.properties.type_of_initiative)\n        tois.forEach(function(toi) {\n          if(toi == entry.type_of_initiative_tag) {\n            var newSelected = document.createAttribute('selected')\n            newOption.setAttributeNode(newSelected)\n          }\n        })\n      }\n\n      var label = document.createTextNode(entry.label[lang]); //FIXME fallback langs\n      newOption.appendChild(label)\n\n      toiSelect.appendChild(newOption)\n    })\n\n  }\n\n  // load taxonomy from server\n  redFetch( [ taxonomy.getLangTaxURL(lang), \"https://raw.githubusercontent.com/TransforMap/transformap-viewer-translations/master/taxonomy-backup/susy/taxonomy.\"+lang+\".json\" ],\n    fillTOIs,\n    function(error) { console.error(\"none of the taxonomy data urls available\") } );\n\n  function addFreeTagsRow() {\n    var freetags = document.getElementById('freetags')\n\n    var lastRow = freetags.lastChild\n    while (lastRow.nodeType === 3) { // 3 = text-node\n      lastRow = lastRow.previousSibling\n    }\n\n    var keyNode = (lastRow.firstChild.nodeType === 1) ? lastRow.firstChild : lastRow.firstChild.nextSibling\n    var newNr = parseInt(keyNode.id.slice(-1)) + 1\n\n    var newRow = document.createElement('div')\n    var divClass = document.createAttribute('class')\n    divClass.value = 'row'\n    newRow.setAttributeNode(divClass)\n    var newKey = document.createElement('input')\n    var newValue = document.createElement('input')\n    var keyId = document.createAttribute('id')\n    keyId.value = 'key' + newNr\n    var valueId = document.createAttribute('id')\n    valueId.value = 'value' + newNr\n    newKey.setAttributeNode(keyId)\n    newValue.setAttributeNode(valueId)\n\n    var elementName = document.createAttribute('name')\n    elementName.value = 'freetags'\n    newKey.setAttributeNode(elementName)\n    newValue.setAttributeNode(elementName.cloneNode(true))\n\n    newRow.appendChild(newKey)\n    newRow.appendChild(newValue)\n    freetags.appendChild(newRow)\n  }\n\n  var currentData = {}\n\n  function fillForm (placeData) {\n    currentData = placeData\n\n    if (currentData._deleted) {\n      document.getElementById('deleted').style.display = \"block\"\n    }\n\n    if (currentData.properties) {\n      for (var key in currentData.properties) {\n        // ignore DB-generated fields\n        if (/^_/.test(key)) {\n          continue\n        }\n\n        var field = document.getElementById('_key_' + key)\n        var value = currentData.properties[key]\n\n        if (field) {\n          // console.log(field)\n          // console.log(value)\n          field.value = value\n        } else { // put it into \"free tags\"\n          // get last child\n          var freetags = document.getElementById('freetags')\n          var lastRow = freetags.lastChild\n          while (lastRow.nodeType === 3) { // 3 = text-node\n            lastRow = lastRow.previousSibling\n          }\n\n          // set data on last child\n          var keyNode = (lastRow.firstChild.nodeType === 1) ? lastRow.firstChild : lastRow.firstChild.nextSibling\n          keyNode.value = key\n          var valueNode = (lastRow.lastChild.nodeType === 1) ? lastRow.lastChild : lastRow.lastChild.previousSibling\n          valueNode.value = value\n\n          addFreeTagsRow()\n        }\n      }\n    }\n    if (currentData.geometry && currentData.geometry.coordinates) {\n      var lon = currentData.geometry.coordinates[0]\n      var lat = currentData.geometry.coordinates[1]\n      if (lat === undefined || lon === undefined) {\n        console.error('lat or lon empty')\n        return\n      }\n\n      document.getElementById('_geometry_lon').value = lon\n      document.getElementById('_geometry_lat').value = lat\n\n      map.my_current_marker = new L.marker([lat, lon], { icon: new map.my_placeMarker() })\n      map.my_editableLayers.addLayer(map.my_current_marker)\n\n      map.my_drawControl = map.getDrawControl(false)\n      map.addControl(map.my_drawControl)\n\n      map.panTo(new L.LatLng(lat, lon))\n    } else { // allow adding a marker\n      map.my_drawControl = map.getDrawControl(true)\n      map.addControl(map.my_drawControl)\n    }\n    if(currentData.properties._id) \n      document.getElementById('_id').value = currentData.properties._id\n    else if(currentData._id)\n      document.getElementById('_id').value = currentData._id\n  }\n\n  if (place) {\n    redFetch(dataUrls, fillForm, function (e) {\n      console.error(e)\n      map.my_drawControl = map.getDrawControl(true)\n      map.addControl(map.my_drawControl)\n    })\n  } else {\n    map.my_drawControl = map.getDrawControl(true)\n    map.addControl(map.my_drawControl)\n  }\n\n  function createCORSRequest (method, url) {\n    // taken from https://www.html5rocks.com/en/tutorials/cors/\n    var xhr = new XMLHttpRequest()\n    if ('withCredentials' in xhr) {\n      // Check if the XMLHttpRequest object has a \"withCredentials\" property.\n      // \"withCredentials\" only exists on XMLHTTPRequest2 objects.\n      xhr.open(method, url, true)\n    } else if (typeof XDomainRequest !== 'undefined') {\n      // Otherwise, check if XDomainRequest.\n      // XDomainRequest only exists in IE, and is IE's way of making CORS requests.\n      xhr = new XDomainRequest()\n      xhr.open(method, url)\n    } else {\n      // Otherwise, CORS is not supported by the browser.\n      xhr = null\n    }\n    return xhr\n  }\n\n  function clickSubmit() {\n    console.log('clickSubmit enter')\n    const requiredFields = [ '_key_type_of_initiative','_key_name','_geometry_lat','_geometry_lon']\n    for(var i = 0; i < requiredFields.length; i++) {\n      var id = requiredFields[i]\n      var value = document.getElementById(id).value\n      if(! value || !value.length) {\n        console.error('submit: field ' + id + ' empty')\n        alert('Error on submit: field ' + id.replace(/^_key_/, '') + ' is not allowed to be empty')\n        return false\n      }\n    }\n\n    var data = {\n      'type': 'Feature',\n      'properties': {\n      },\n      'geometry': {\n        'type': 'Point',\n        'coordinates': [\n          parseFloat(document.getElementById('_geometry_lon').value),\n          parseFloat(document.getElementById('_geometry_lat').value)\n        ]\n      }\n    }\n\n    // all 'input type=text'\n    var allInputs = document.getElementsByTagName('input')\n    var freeTags = { keys: {}, values: {} }\n\n    console.log(allInputs)\n\n    for (var i = 0; i < allInputs.length; i++) {\n      var element = allInputs[i]\n      if (!element.type === 'text') {\n        continue\n      }\n      if (element.value && element.id) {\n        console.log(element.id + ': ' + element.value)\n        if (/^_key_/.test(element.id)) {\n          var key = element.id.replace(/^_key_/, '')\n          data.properties[key] = element.value.trim()\n       // element of 'free tags'\n        } else if (/^key[0-9]+$/.test(element.id) && element.name === 'freetags') {\n          var nr = element.id.replace(/^key/, '')\n          freeTags.keys[nr] = element.value\n        } else if (/^value[0-9]+$/.test(element.id) && element.name === 'freetags') {\n          var nr = element.id.replace(/^value/, '')\n          freeTags.values[nr] = element.value\n        }\n      }\n    }\n    console.log(freeTags)\n\n    for (var keynr in freeTags.keys) {\n      var key = freeTags.keys[keynr].trim()\n      if (key && freeTags.values[keynr]) { // only take if key and value are not \"\"\n        data.properties[key] = freeTags.values[keynr].trim()\n      }\n    }\n\n    // drop-down\n    var allSelects = document.getElementsByTagName('select')\n    for (var i = 0; i < allSelects.length; i++) {\n      var element = allSelects[i]\n      if (/^_key_/.test(element.id) && element.value) {\n        var key = element.id.replace(/^_key_/, '')\n\n        for(var childCounter = 0; childCounter < element.children.length; childCounter++) {\n          var child = element.children[childCounter]\n          if(child.selected == true) {\n            data.properties[key] = (data.properties[key] ? (data.properties[key] + ';') : '') + child.value\n          }\n        }\n      }\n    }\n\n    // textarea\n    var allTextareas = document.getElementsByTagName('textarea')\n    for (var i = 0; i < allTextareas.length; i++) {\n      var element = allTextareas[i]\n      if (/^_key_/.test(element.id) && element.value) {\n        var key = element.id.replace(/^_key_/, '')\n        data.properties[key] = element.value.trim()\n      }\n    }\n\n    console.log(data)\n\n    const uuid = document.getElementById('_id').value\n    const sendData = JSON.stringify(data)\n    console.log(sendData)\n\n    // PUT is for UPDATE, POST is for CREATE\n    var xhr = createCORSRequest(uuid ? 'PUT' : 'POST', endpoint + uuid)\n    xhr.setRequestHeader('Content-Type', 'application/json')\n    xhr.send(sendData)\n    console.log(xhr)\n\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState == 4) {\n        if (xhr.status == 200) {\n          var retJson = JSON.parse(xhr.responseText)\n          console.log(retJson)\n          document.getElementById('_id').value = retJson.id\n        } else {\n          console.error(xhr)\n        }\n      }\n    }\n    document.getElementById('deleted').style.display = \"none\"\n  }\n  document.getElementById('save').onclick = clickSubmit\n\n  function clickDelete() {\n    const uuid = document.getElementById('_id').value\n    if (!uuid) {\n      alert('nothing to delete')\n      return\n    }\n    var xhr = createCORSRequest('DELETE', endpoint + uuid)\n    xhr.send()\n    console.log(xhr)\n\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState == 4) {\n        if (xhr.status == 200) {\n          var retJson = JSON.parse(xhr.responseText)\n          console.log(retJson)\n        } else {\n          console.error(xhr)\n        }\n      }\n    }\n    document.getElementById('deleted').style.display = \"block\"\n  }\n  document.getElementById('delete').onclick = clickDelete\n  document.getElementById('plus').onclick = addFreeTagsRow\n\n  console.log('editor initialize end')\n}\n","/*\n * This library provides a simple function to parse URL parameters\n *\n * Mon  3 Oct 15:07:12 CEST 2016\n * Michael Maier (species@github), WTFPL\n *\n * returns object with key:value pairs\n\n This program is free software. It comes without any warranty, to\n     * the extent permitted by applicable law. You can redistribute it\n     * and/or modify it under the terms of the Do What The Fuck You Want\n     * To Public License, Version 2, as published by Sam Hocevar. See\n     * http://www.wtfpl.net/ for more details. */\n\nfunction getUrlVars () {\n  var vars = {}\n  var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n    vars[key] = value.replace(/#.*$/, '')\n  })\n  return vars\n}\n\nmodule.exports = getUrlVars\n","const L = require('leaflet')\nconst L_Hash = require('leaflet-hash')\nconst L_Draw = require('leaflet-draw')\nconst getUrlVars = require('./getUrlVars.js')\n\nvar editableLayers\nvar drawControl\nvar placeMarker\n\nfunction getDrawControl (allowNewMarker) {\n  var markerValue = allowNewMarker ? { icon: new placeMarker() } : false\n  var options = {\n    position: 'bottomleft',\n    draw: {\n      polyline: false,\n      polygon: false,\n      rectangle: false,\n      circle: false,\n      marker: markerValue\n    },\n    edit: {\n      featureGroup: editableLayers, // REQUIRED!!\n      remove: false\n    }\n  }\n  return new L.Control.Draw(options)\n}\n\nfunction initMap () {\n  console.log('initMap start')\n  var map\n\n  var attrOsm = 'Map data by <a href=\"https://openstreetmap.org\">OpenStreetMap</a> contributors, under <a href=\"https://www.openstreetmap.org/copyright\">ODbL</a>. '\n  var attrPois = 'POIs by <a href=\"http://solidariteconomy.eu\">SUSY</a>, <a href=\"https://creativecommons.org/publicdomain/zero/1.0/\">CC-0</a>. '\n  var leafletBgMaps\n  var zoom\n  var defaultlayer\n  var center\n  var baseMaps = {}\n\n  baseMaps['mapnik'] = new L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n    attribution: attrOsm + attrPois,\n    maxZoom: 19,\n    noWrap: true\n  })\n  baseMaps['stamen_terrain'] = new L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.png', {\n    attribution: 'Map tiles by <a href=\"http://stamen.com/\">Stamen Design</a>, ' +\n        'under <a href=\"https://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a>. ' +\n        attrOsm + attrPois,\n    maxZoom: 18,\n    noWrap: true\n  })\n  baseMaps['stamen_terrain_bg'] = new L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain-background/{z}/{x}/{y}.png', {\n    attribution: 'Map tiles by <a href=\"http://stamen.com/\">Stamen Design</a>, ' +\n        'under <a href=\"https://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a>. ' +\n        attrOsm + attrPois,\n    maxZoom: 18,\n    noWrap: true\n  })\n  baseMaps['hot'] = new L.tileLayer('http://tile-{s}.openstreetmap.fr/hot/{z}/{x}/{y}.png', {\n    attribution: 'Tiles courtesy of <a href=\"http://hot.openstreetmap.org/\">Humanitarian OpenStreetMap Team</a>. ' +\n        attrOsm + attrPois,\n    maxZoom: 20,\n    noWrap: true\n  })\n\n  if (!leafletBgMaps) {\n    leafletBgMaps = {\n      'Stamen - Terrain': baseMaps['stamen_terrain'],\n      'Stamen - Terrain Background': baseMaps['stamen_terrain_bg'],\n      'OpenStreetMap - Mapnik': baseMaps['mapnik'],\n      'Humanitarian OpenStreetMap ': baseMaps['hot']\n    }\n  }\n  if (!defaultlayer) {\n    defaultlayer = baseMaps['mapnik']\n  }\n\n  map = L.map('map', {\n    zoomControl: true,\n    center: center ? center : new L.LatLng(51.1657, 10.4515),\n    zoom: zoom ? zoom : 15,\n    layers: defaultlayer\n  })\n\n  const ctrl = new L.Control.Layers(leafletBgMaps)\n  map.addControl(ctrl)\n  var hash = new L.Hash(map) // Leaflet persistent Url Hash function\n\n  // leaflet draw\n  editableLayers = new L.FeatureGroup()\n  map.addLayer(editableLayers)\n  placeMarker = L.Icon.extend({\n    options: {\n      shadowUrl: null,\n      iconAnchor: new L.Point(12, 40),\n      iconSize: new L.Point(25, 40),\n      iconUrl: 'marker-green.png'\n    }\n  })\n\n  map.on(L.Draw.Event.CREATED, function (e) {\n    var type = e.layerType\n    var layer = e.layer\n\n    if (type === 'marker') {\n      layer.bindPopup('A popup!')\n    }\n\n    editableLayers.addLayer(layer)\n    map.my_current_marker = layer\n    document.getElementById('_geometry_lon').value = layer._latlng.lng.toFixed(6)\n    document.getElementById('_geometry_lat').value = layer._latlng.lat.toFixed(6)\n\n    map.removeControl(map.my_drawControl)\n    map.my_drawControl = getDrawControl(false) // deactivate \"add marker\" after the 1st one\n    map.addControl(map.my_drawControl)\n      // fixme instantly enable 'edit' mode of layer\n  })\n\n  map.on('draw:editmove', function (e) {\n    console.log('editmove')\n    console.log(e)\n    document.getElementById('_geometry_lon').value = e.layer._latlng.lng.toFixed(6)\n    document.getElementById('_geometry_lat').value = e.layer._latlng.lat.toFixed(6)\n  })\n\n  map.my_editableLayers = editableLayers\n  map.my_drawControl = drawControl\n  map.my_placeMarker = placeMarker\n  map.getDrawControl = getDrawControl\n\n  map.updateMarkerFromForm = function () {\n    const lat = document.getElementById('_geometry_lat').value\n    const lon = document.getElementById('_geometry_lon').value\n    console.log('new lat: ' + lat + ' lon: ' + lon)\n\n    if (lat && lon) {\n      const coords = L.latLng(lat, lon)\n      map.my_current_marker.setLatLng(coords)\n      map.panTo(coords)\n    }\n  }\n  document.getElementById('_geometry_lat').onblur = map.updateMarkerFromForm\n  document.getElementById('_geometry_lon').onblur = map.updateMarkerFromForm\n\n  // console.log(map)\n\n  console.log('initMap end')\n  return map\n}\n\nmodule.exports = initMap\n","/*\n * This library provides a 'fetch', where you can use fallback URIs, to build on redundant servers.\n *\n * Mon  3 Oct 15:07:12 CEST 2016\n * Michael Maier (species@github), WTFPL\n *\n * Give it an array of resources, that can be fetched from different urls.\n * Will try to fetch them in the provided order.\n * Execute success_function on the first successful fetch, and error_function only if all resources fail to fetch.\n */\n\n/* This program is free software. It comes without any warranty, to\n     * the extent permitted by applicable law. You can redistribute it\n     * and/or modify it under the terms of the Do What The Fuck You Want\n     * To Public License, Version 2, as published by Sam Hocevar. See\n     * http://www.wtfpl.net/ for more details. */\n\n/* new version of getting map data with promises\n\n  taken from https://blog.hospodarets.com/fetch_in_action\n*/\n\nvar processStatus = function (response) {\n    // status \"0\" to handle local files fetching (e.g. Cordova/Phonegap etc.)\n  if (response.status === 200 || response.status === 0) {\n    return Promise.resolve(response)\n  } else {\n    return Promise.reject(new Error(response.statusText))\n  }\n}\n\nvar parseJson = function (response) {\n  return response.json()\n}\n\n/* @returns {wrapped Promise} with .resolve/.reject/.catch methods */\n// It goes against Promise concept to not have external access to .resolve/.reject methods, but provides more flexibility\nvar getWrappedPromise = function () {\n  var wrappedPromise = {}\n  var promise = new Promise(function (resolve, reject) {\n    wrappedPromise.resolve = resolve\n    wrappedPromise.reject = reject\n  })\n  wrappedPromise.then = promise.then.bind(promise)\n  wrappedPromise.catch = promise.catch.bind(promise)\n  wrappedPromise.promise = promise// e.g. if you want to provide somewhere only promise, without .resolve/.reject/.catch methods\n  return wrappedPromise\n}\n\n/* @returns {wrapped Promise} with .resolve/.reject/.catch methods */\nvar getWrappedFetch = function () {\n  var wrappedPromise = getWrappedPromise()\n  var args = Array.prototype.slice.call(arguments)// arguments to Array\n\n  window.fetch.apply(null, args)// calling original fetch() method\n        .then(function (response) {\n          wrappedPromise.resolve(response)\n        }, function (error) {\n          wrappedPromise.reject(error)\n        })\n        .catch(function (error) {\n          wrappedPromise.catch(error)\n        })\n  return wrappedPromise\n}\n\n/**\n * Fetch JSON by url\n * @param { {\n *  url: {String},\n *  [cacheBusting]: {Boolean}\n * } } params\n * @returns {Promise}\n*/var MAX_WAITING_TIME = 5000// in ms\n\nvar getJSON = function (params) {\n  var wrappedFetch = getWrappedFetch(\n        params.cacheBusting ? params.url + '?' + new Date().getTime() : params.url,\n    {\n      method: 'get', // optional, \"GET\" is default value\n      headers: {\n        'Accept': 'application/json'\n      }\n    })\n\n  var timeoutId = setTimeout(function () {\n    wrappedFetch.reject(new Error('Load timeout for resource: ' + params.url))// reject on timeout\n  }, MAX_WAITING_TIME)\n\n  return wrappedFetch.promise// getting clear promise from wrapped\n        .then(function (response) {\n          clearTimeout(timeoutId)\n          return response\n        })\n        .then(processStatus)\n        .then(parseJson)\n}\n\nfunction myGetJSON (url, successFunction, errorFunction) {\n  var getJSONparams = { url: url, cacheBusting: true }\n\n  getJSON(getJSONparams).then(\n    function (data) { successFunction(data) },\n    function (error) { errorFunction(error) }\n  )\n}\n\nfunction redundantFetch (dataUrlArray, successFunction, errorFunction) {\n  if (!(!!dataUrlArray && Array === dataUrlArray.constructor)) {\n    console.error('redundantFetch: argument is no array')\n    console.error(dataUrlArray)\n    return false\n  }\n  var currentUrl = dataUrlArray[0]\n  if (typeof (currentUrl) !== 'string') {\n    console.error('redundantFetch: url is no string')\n    return false\n  }\n\n  console.log('redundantFetch called, urls:')\n  console.log(dataUrlArray)\n\n  dataUrlArray.shift()\n\n  var localErrorFunction\n  var localSuccessFunction\n  if (dataUrlArray.length == 0) { // last iteration\n    localSuccessFunction = successFunction\n    localErrorFunction = errorFunction\n  } else {\n    localSuccessFunction = successFunction\n    localErrorFunction = function (error) {\n      redundantFetch(dataUrlArray, successFunction, errorFunction)\n    }\n  }\n\n  var getJSONparams = { url: currentUrl, cacheBusting: true }\n  getJSON(getJSONparams).then(\n    function (data) { localSuccessFunction(data); console.log('rfetch: success on '); console.log(data) },\n    function (error) { localErrorFunction(error); console.log('rfetch: fail on '); console.log(error) }\n  )\n}\n\nmodule.exports = redundantFetch\n","/*\n * This library handles taxonomy related stuff for the transformap editor\n *\n * Mon  3 Oct 15:07:12 CEST 2016\n * Michael Maier (species@github), WTFPL\n\n * This program is free software. It comes without any warranty, to\n * the extent permitted by applicable law. You can redistribute it\n * and/or modify it under the terms of the Do What The Fuck You Want\n * To Public License, Version 2, as published by Sam Hocevar. See\n * http://www.wtfpl.net/ for more details. */\n\n\nfunction getLangTaxURL(lang) {\n  if(!lang) {\n    console.error(\"setFilterLang: no lang given\");\n    return false;\n  }\n  \n  var tax_query =\n    'prefix bd: <http://www.bigdata.com/rdf#> ' +\n    'prefix wikibase: <http://wikiba.se/ontology#> ' +\n    'prefix wdt: <http://base.transformap.co/prop/direct/>' +\n    'prefix wd: <http://base.transformap.co/entity/>' +\n    'SELECT ?item ?itemLabel ?instance_of ?subclass_of ?type_of_initiative_tag ?wikipedia ?description ' +\n    'WHERE {' +\n      '?item wdt:P8* wd:Q8 .' +\n      '?item wdt:P8 ?subclass_of .' +\n      'OPTIONAL { ?item wdt:P4 ?instance_of . }' +\n      'OPTIONAL { ?item wdt:P15 ?type_of_initiative_tag }' +\n      'OPTIONAL { ?item schema:description ?description FILTER(LANG(?description) = \"'+lang+'\") }' +\n      'OPTIONAL { ?wikipedia schema:about ?item . ?wikipedia schema:inLanguage \"en\"}' +\n      'SERVICE wikibase:label {bd:serviceParam wikibase:language \"'+lang+'\" }' +\n    '}';\n   \n   return 'https://query.base.transformap.co/bigdata/namespace/transformap/sparql?query=' +encodeURIComponent(tax_query) + \"&format=json\";\n}\n\nmodule.exports = {\n  getLangTaxURL: getLangTaxURL\n}\n"]}